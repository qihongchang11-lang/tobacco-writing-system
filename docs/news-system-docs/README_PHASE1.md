# çƒŸè‰æŠ¥é£æ ¼æ”¹å†™ç³»ç»Ÿ - Phase 1

## ğŸ¯ Phase 1 ç›®æ ‡

å¿«é€Ÿæ„å»ºå¯ç”¨çš„æ ¸å¿ƒç³»ç»Ÿï¼ŒåŒ…å«å…³é”®æŠ¤æ ï¼š
- âœ… çº¦æŸè§£ç ï¼ˆå ä½ç¬¦ + æ–°æ•°å­—æ£€æŸ¥ + å®ä½“é”å®šï¼‰
- âœ… BM25çŸ¥è¯†æ£€ç´¢ + LRUç¼“å­˜
- âœ… FastAPIæœåŠ¡æ¶æ„
- âœ… YAMLé…ç½®å¤–éƒ¨åŒ–

## ğŸ“ é¡¹ç›®ç»“æ„

```
tobacco-writing-pipeline/
â”œâ”€â”€ api_main.py              # FastAPIä¸»æœåŠ¡
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ constraint_decoder.py    # çº¦æŸè§£ç å™¨
â”‚   â””â”€â”€ knowledge_retriever.py   # çŸ¥è¯†æ£€ç´¢å™¨
â”œâ”€â”€ config/
â”‚   â””â”€â”€ column_rules.yaml        # æ ç›®é…ç½®
â”œâ”€â”€ data/
â”‚   â””â”€â”€ knowledge/
â”‚       â””â”€â”€ tobacco_knowledge.txt # çŸ¥è¯†åº“
â”œâ”€â”€ requirements-phase1.txt  # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ start_api.bat           # å¯åŠ¨è„šæœ¬
â””â”€â”€ test_api.py             # æµ‹è¯•è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒ

ç¡®ä¿`.env`æ–‡ä»¶ä¸­å·²é…ç½®Claude APIå¯†é’¥ï¼š

```bash
CLAUDE_API_KEY=your_actual_api_key_here
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements-phase1.txt
```

### 3. å¯åŠ¨æœåŠ¡

**Windows:**
```bash
start_api.bat
```

**æˆ–æ‰‹åŠ¨å¯åŠ¨:**
```bash
python api_main.py
```

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨

### 4. æµ‹è¯•

æ‰“å¼€æ–°ç»ˆç«¯ï¼Œè¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python test_api.py
```

## ğŸ“– APIæ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®ï¼š
- **APIæ–‡æ¡£**: http://localhost:8080/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8080/

### ä¸»è¦ç«¯ç‚¹

#### POST /rewrite

æ”¹å†™æ–‡ç« 

**è¯·æ±‚ä½“:**
```json
{
  "text": "åŸæ–‡å†…å®¹...",
  "genres": ["ä¼šè®®æŠ¥é“"],
  "strict_mode": false
}
```

**å“åº”:**
```json
{
  "column": {
    "id": "news_general",
    "name": "è¦é—»",
    "route_confidence": 0.86
  },
  "title": "æ”¹å†™åçš„æ ‡é¢˜",
  "lead": "æ”¹å†™åçš„å¯¼è¯­",
  "body": {
    "outline": ["èƒŒæ™¯","ä¸¾æª","æˆæ•ˆ","å±•æœ›"],
    "text": "æ”¹å†™åçš„æ­£æ–‡"
  },
  "evidence": [
    {
      "snippet": "ç›¸å…³çŸ¥è¯†...",
      "score": 0.78,
      "source": "local:tobacco_knowledge.txt#L1"
    }
  ],
  "audit": {
    "entities_locked": {
      "dates": ["2024å¹´10æœˆ15æ—¥"],
      "numbers": ["15.6äº¿å…ƒ", "8.5%"],
      "orgs": ["å›½å®¶çƒŸè‰ä¸“å–å±€"]
    },
    "new_numbers_detected": [],
    "placeholder_leak_fixed": false,
    "retries": 0,
    "needs_review": false
  },
  "scores": {
    "style_consistency": 0.90,
    "factual_consistency": 1.0,
    "compliance": 0.95,
    "overall": 0.92
  },
  "meta": {
    "latency_ms": 1840,
    "model": "claude-3-sonnet-20241022",
    "pipeline_version": "phase1-2025-11-05"
  }
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### column_rules.yaml

æ ç›®é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒçƒ­åŠ è½½ï¼ˆé‡å¯æœåŠ¡ç”Ÿæ•ˆï¼‰ï¼š

```yaml
version: "1.0.0"
columns:
  - id: news_general
    name: è¦é—»
    types: ["è¡Œä¸šæ–°é—»","æ´»åŠ¨æŠ¥é“","ä¼šè®®æŠ¥é“"]
    structure: ["èƒŒæ™¯","ä¸¾æª","æˆæ•ˆ","å±•æœ›"]
```

### tobacco_knowledge.txt

çŸ¥è¯†åº“æ–‡ä»¶ï¼Œæ¯è¡Œä¸€æ¡çŸ¥è¯†ï¼š

```
å›½å®¶çƒŸè‰ä¸“å–å±€æ˜¯çƒŸè‰è¡Œä¸šçš„æœ€é«˜ç®¡ç†æœºæ„...
ä¸­å›½çƒŸè‰æ€»å…¬å¸è´Ÿè´£å…¨å›½çƒŸè‰ç”Ÿäº§ç»è¥ç®¡ç†...
```

## âœ… éªŒæ”¶æ¸…å•

Phase 1 æ ¸å¿ƒåŠŸèƒ½ï¼š

- [x] æ•°å­—/æ—¥æœŸ 100% ä¿ç•™
- [x] ç™½åå•æœºæ„åé”å®š
- [x] æ–°æ•°å­—æ£€æŸ¥ï¼ˆä¸å¼•å…¥åŸæ–‡ä¸å­˜åœ¨çš„æ•°å­—ï¼‰
- [x] å ä½ç¬¦æ³„æ¼æ£€æµ‹
- [x] BM25çŸ¥è¯†æ£€ç´¢ + LRUç¼“å­˜
- [x] æ ç›®è‡ªåŠ¨è·¯ç”±
- [x] 1-2æ¬¡æ™ºèƒ½é‡è¯•æœºåˆ¶
- [x] å®Œæ•´çš„å®¡è®¡ä¿¡æ¯
- [x] å“åº”æ—¶é—´ <5ç§’

## ğŸ”„ ä¸‹ä¸€æ­¥ (Phase 2)

- [ ] å¤šæ ·æ€§é‡è¯•ç­–ç•¥
- [ ] å¯¼è¯­è¦ç´ éªŒè¯å™¨
- [ ] YAMLçƒ­åŠ è½½ + ç‰ˆæœ¬ç®¡ç†
- [ ] åˆè§„è§„åˆ™æ£€æŸ¥
- [ ] æ›´ä¸°å¯Œçš„çŸ¥è¯†åº“
- [ ] æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥**: ç¡®ä¿åœ¨`.env`ä¸­é…ç½®æ­£ç¡®çš„Claude APIå¯†é’¥
2. **ç½‘ç»œ**: éœ€è¦èƒ½è®¿é—®Claude API
3. **å“åº”æ—¶é—´**: é¦–æ¬¡è°ƒç”¨å¯èƒ½è¾ƒæ…¢ï¼Œåç»­ä¼šæœ‰ç¼“å­˜åŠ é€Ÿ
4. **è´¨é‡**: Phase 1ä¸ºå¿«é€ŸéªŒè¯ç‰ˆæœ¬ï¼ŒæŸäº›åŠŸèƒ½ä¸ºç®€åŒ–å®ç°

## ğŸ› æ•…éšœæ’é™¤

### 1. "Core components not initialized"

æ£€æŸ¥ï¼š
- `config/column_rules.yaml` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- `data/knowledge/tobacco_knowledge.txt` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### 2. "APIè°ƒç”¨å¤±è´¥"

æ£€æŸ¥ï¼š
- `.env` æ–‡ä»¶ä¸­çš„ `CLAUDE_API_KEY` æ˜¯å¦æ­£ç¡®
- ç½‘ç»œæ˜¯å¦èƒ½è®¿é—®Claude API

### 3. å¯¼å…¥é”™è¯¯

ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
```bash
pip install -r requirements-phase1.txt
```

## ğŸ“ è”ç³»æ–¹å¼

é‡åˆ°é—®é¢˜è¯·æŸ¥çœ‹æ—¥å¿—æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**ç‰ˆæœ¬**: Phase 1 - 2025-11-05
**çŠ¶æ€**: âœ… å¯ç”¨