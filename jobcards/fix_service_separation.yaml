# fix/service-separation 任务卡
# 目标：彻底分离东方烟草报改写系统与CNIPA专利MVP，避免端口/路径冲突

metadata:
  id: fix-service-separation
  title: 服务完全分离 - 烟草报系统 vs 专利系统
  priority: critical
  assignee: K2
  created: 2025-11-11
  due: 2025-11-12

objectives:
  - 创建完全独立的API入口文件
  - 固定不同端口并支持.env配置
  - 更新OpenAPI文档标识
  - 添加CI验证测试
  - 更新文档说明

requirements:
  # 1. 独立入口文件
  - name: 烟草报系统入口
    file: news_api_main.py
    port: 8081
    service_name: "东方烟草报风格改写系统"
    openapi_title: "东方烟草报风格改写API"
    description: "基于新华财经风格的烟草行业文章智能改写"

  - name: 专利系统入口
    file: patent_api_main.py
    port: 8082
    service_name: "CNIPA发明专利高质量改写系统"
    openapi_title: "CNIPA专利文档生成API"
    description: "中国国家知识产权局合规的专利四件套自动生成"

  # 2. 环境配置
  - name: 端口配置
    env_file: .env
    variables:
      NEWS_API_PORT: 8081
      PATENT_API_PORT: 8082
      NEWS_API_HOST: "0.0.0.0"
      PATENT_API_HOST: "0.0.0.0"

  # 3. 健康检查规范
  - endpoint: /health
    response_fields:
      - service: 必须匹配系统名称
      - version: 系统版本号
      - port: 当前服务端口
      - mode: 运行模式

  # 4. CI测试要求
  - test_type: openapi_validation
    requirements:
      - openapi.json中info.title必须匹配指定标题
      - /health响应的service字段必须匹配系统名称
      - 端口必须固定且正确
      - 不允许有路径冲突

tasks:
  - [ ] 创建 news_api_main.py (烟草报系统)
  - [ ] 创建 patent_api_main.py (专利系统)
  - [ ] 更新 .env 配置文件
  - [ ] 添加 CI 测试脚本
  - [ ] 更新 README 文档
  - [ ] 验证端口分离
  - [ ] 验证 OpenAPI 文档
  - [ ] 创建 PR

acceptance_criteria:
  - 两个系统可以同时运行不冲突
  - 端口固定且可配置
  - OpenAPI文档标题正确
  - 健康检查返回正确的service名称
  - CI测试通过
  - 文档更新完整

notes: |
  这是一个关键的基础设施改进，确保两个系统完全独立运行，
  避免之前出现的端口冲突和服务混淆问题。